<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulación de Barcazas con Tablas y Gráficos</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* General Styling */
    body {
      background-color: #f8f9fa;
    }

    h1,
    h3,
    h4 {
      text-align: center;
    }

    /* Scrollable Container for Tables */
    .scrollable-container {
      max-height: 400px;
      /* Limit table height */
      overflow-y: auto;
      /* Enable vertical scrolling */
      border: 1px solid #ddd;
      /* Add a border */
      border-radius: 0.5rem;
      padding: 1rem;
      background-color: rgb(0, 0, 0);
      /* White background */
    }

      .fondo {
      font-family: Arial, sans-serif;       
      background-image: url(img/fondoBarco2.jpg);
      margin: 50px;
      height: auto;
      width: auto;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;

    }

    /* Styling Editable Cells */
    td[contenteditable="true"] {
      background-color: #faf8f8;
      outline: none;
      cursor: text;
    }

    td[contenteditable="true"]:focus {
      background-color: #e9ecef;
      border: 1px solid #000000;
    }

    /* Table Headers */
    .table-title {
      background-color: #011c3889;
      color: white;
      text-align: center;
    }

    /* Formula Box Styling */
    .formula-box {
      background-color: #0000005a;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #ffffff;
      margin-top: 1rem;
      color: white;
    }
    .fondoTablas{
      background-color: rgba(0, 0, 0, 0.589);
      color: white;
    }

    .button{
      background-color: cadetblue;
      color: white;
      padding: 6px 12px;
      margin-top: 5px;
      background-color: #000000c8;
      color: white;
      border-radius:25px;
      
    }
    .button-container {
      display: flex;
      justify-content: center;
      margin-top: 20px; 
    }
    .button:hover{
      background-color: rgba(0, 88, 83, 0.825);
    }
    .titulos{
      background-color: rgba(0, 0, 0, 0.744);
      color: white;
      font-family: 'Times New Roman', Times, serif;
      border-radius: 0.5rem;
      border: 1px solid #ffffff;
    }
    .tipoLetra{
      font-size: 22px;
    }

    
  </style>
</head>

<body class="fondo">
  <div class="container py-5">
    <div class="button-container">
    <h1 class="titulos ">Simulación de Barcazas</h1>
    </div>
    

    <!-- Simulation Form -->
    <form id="simulationForm">
      <div class="mb-3">
        <label for="days" class="form-label titulos tipoLetra">Número de días a simular:</label>
        <input type="number" id="days" name="days" class="form-control" min="1" required>
      </div>
      <div class="button-container">
        <button type="submit" class="btn-xs button">Generar Datos</button>
      </div>
      
    </form>

    <!-- Main Simulation Table -->
    <div id="tablesContainer" class="mb-4" style="display: none;">
      <h3 class="titulos button-container">Modelo de Simulación de la Cola en el Puerto</h3>
      <div class="scrollable-container">
        <table class="table table-striped">
          <thead class="table-dark">
            <tr>
              <th>Día</th>
              <th>Retrasos Previos</th>
              <th>Número Aleatorio</th>
              <th>Llegadas</th>
              <th>Total a Descargar</th>
              <th>Número Aleatorio (Descargas Posibles)</th>
              <th>Descargas</th>
              <th>Retrasos Nuevos</th>
            </tr>
          </thead>
          <tbody id="simulationTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Probability Tables -->
    <div>
      <div class="button-container">
        <h3 class="titulos">Tablas de Probabilidades</h3>
      </div>
    <div>
      <h4 class="mt-3 titulos">Llegadas</h4>
    </div>
      

      <div class="table-responsive mb-3 fondoTablas">
        <table class="table table-bordered">
          <thead class="table-title fondoTablas">,
            <tr>
              <th>Demanda</th>
              <th>Probabilidad</th>
              <th>Límite Inferior</th>
              <th>Acumulado</th>
            </tr>
          </thead>
          <tbody class="fondoTablas">
            <tr>
              <td>0</td>
              <td>0.13</td>
              <td>0.00</td>
              <td>0.13</td>
            </tr>
            <tr>
              <td>1</td>
              <td>0.17</td>
              <td>0.13</td>
              <td>0.30</td>
            </tr>
            <tr>
              <td>2</td>
              <td>0.15</td>
              <td>0.30</td>
              <td>0.45</td>
            </tr>
            <tr>
              <td>3</td>
              <td>0.25</td>
              <td>0.45</td>
              <td>0.70</td>
            </tr>
            <tr>
              <td>4</td>
              <td>0.20</td>
              <td>0.70</td>
              <td>0.90</td>
            </tr>
            <tr>
              <td>5</td>
              <td>0.10</td>
              <td>0.90</td>
              <td>1.00</td>
            </tr>
          </tbody>
        </table>
      </div>

      <h4 class="mt-3 titulos">Tasas de Descarga</h4>
      <div class="table-responsive fondoTablas">
        <table class="table table-bordered">
          <thead class="table-title">
            <tr>
              <th>Número</th>
              <th>Probabilidad</th>
              <th>Límite Inferior</th>
              <th>Acumulado</th>
            </tr>
          </thead>
          <tbody class="fondoTablas">
            <tr>
              <td>1</td>
              <td>0.05</td>
              <td>0.00</td>
              <td>0.05</td>
            </tr>
            <tr>
              <td>2</td>
              <td>0.15</td>
              <td>0.05</td>
              <td>0.20</td>
            </tr>
            <tr>
              <td>3</td>
              <td>0.50</td>
              <td>0.20</td>
              <td>0.70</td>
            </tr>
            <tr>
              <td>4</td>
              <td>0.20</td>
              <td>0.70</td>
              <td>0.90</td>
            </tr>
            <tr>
              <td>5</td>
              <td>0.10</td>
              <td>0.90</td>
              <td>1.00</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Formula Box -->
    <div class="formula-box">
      <h4>Fórmulas Clave</h4>
      <p><strong>Llegadas:</strong> RAND(), VLOOKUP para buscar en la tabla de llegadas.</p>
      <p><strong>Descargas:</strong> RAND(), VLOOKUP para buscar en la tabla de tasas de descarga.</p>
    </div>

    <!-- Main Script -->
    <script>
      const arrivals = [
        { demand: 0, lower: 0.0, upper: 0.13 },
        { demand: 1, lower: 0.13, upper: 0.30 },
        { demand: 2, lower: 0.30, upper: 0.45 },
        { demand: 3, lower: 0.45, upper: 0.70 },
        { demand: 4, lower: 0.70, upper: 0.90 },
        { demand: 5, lower: 0.90, upper: 1.0 },
      ];

      const unloadingRates = [
        { unload: 1, lower: 0.0, upper: 0.05 },
        { unload: 2, lower: 0.05, upper: 0.20 },
        { unload: 3, lower: 0.20, upper: 0.70 },
        { unload: 4, lower: 0.70, upper: 0.90 },
        { unload: 5, lower: 0.90, upper: 1.0 },
      ];

      const lookupValue = (random, table) => table.find(item => random >= item.lower && random < item.upper);

      document.getElementById("simulationForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const days = parseInt(document.getElementById("days").value);
        const tableBody = document.getElementById("simulationTableBody");
        tableBody.innerHTML = "";

        let previousDelays = 0;
        for (let day = 1; day <= days; day++) {
          const randomArrival = Math.random().toFixed(4);
          const randomUnload = Math.random().toFixed(4);

          const arrivalData = lookupValue(randomArrival, arrivals);
          const unloadData = lookupValue(randomUnload, unloadingRates);

          const arrivalsValue = arrivalData ? arrivalData.demand : 0;
          const possibleUnload = unloadData ? unloadData.unload : 0;

          const totalToUnload = previousDelays + arrivalsValue;
          const actualUnload = Math.min(totalToUnload, possibleUnload);
          const newDelays = totalToUnload - actualUnload;

          const row = `
            <tr>
              <td>${day}</td>
              <td contenteditable="true" class="editable previous-delays">${previousDelays}</td>
              <td>${randomArrival}</td>
              <td contenteditable="true" class="editable arrivals">${arrivalsValue}</td>
              <td>${totalToUnload}</td>
              <td>${randomUnload}</td>
              <td>${actualUnload}</td>
              <td>${newDelays}</td>
            </tr>`;
          tableBody.insertAdjacentHTML("beforeend", row);

          previousDelays = newDelays;
        }

        document.getElementById("tablesContainer").style.display = "block";
        addEditableListeners();
      });

      const addEditableListeners = () => {
        const tableBody = document.getElementById("simulationTableBody");
        tableBody.addEventListener("input", (event) => {
          const row = event.target.parentElement;

          const previousDelays = parseInt(row.querySelector(".previous-delays").textContent) || 0;
          const arrivals = parseInt(row.querySelector(".arrivals").textContent) || 0;

          const totalToUnload = previousDelays + arrivals;
          const randomUnload = parseFloat(row.children[5].textContent);

          const unloadData = lookupValue(randomUnload, unloadingRates);
          const possibleUnload = unloadData ? unloadData.unload : 0;

          const actualUnload = Math.min(totalToUnload, possibleUnload);
          const newDelays = totalToUnload - actualUnload;

          row.children[4].textContent = totalToUnload;
          row.children[6].textContent = actualUnload;
          row.children[7].textContent = newDelays;
        });
      };
    </script>
  </div>
</body>

</html>